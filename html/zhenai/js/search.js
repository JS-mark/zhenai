var dataArr = [[
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item10.jpg",
		name : "群群",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	}
],
[
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "青玉",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "百丽",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "翩翩",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "璐璐",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	},
	{
		img: "item2.jpg",
		name : "圆圆",
		area : "河北 石家庄 未婚 182cm",
		info : "哈哈哈哈哈哈哈"
	}
]]

var pageSize = 0;
window.onload = function(){
	// 1、页面加载时。初始化第一页的数据和布局
	var boxes = document.getElementsByClassName('ph-item');
	var waterfull = document.getElementsByClassName('waterfull')[0];
	var waterfullCon = document.getElementById('waterfull-con');
	var waterfullEnd = document.getElementsByClassName('waterfullEnd')[0];
	var waterloading = document.getElementsByClassName('waterloading')[0];
	var boxW = boxes[0].offsetWidth;
	var hArr = [];
	setWaterfull();



	 //判断是否触底
	window.onscroll = function(){
		if(bottomed()){
			if(pageSize<dataArr.length){
				console.log( pageSize );
				var data = dataArr[pageSize];

				for(var j =0; j<data.length; j++){
					var eleText =  ' <a href="javascript:;"> '
			          +'     <div class="item-img"><img src="images/'+data[j].img+'"id=img'+j+'> '
			          +'         <div class="how"> '
			          +'             <i></i> 打招呼 '
			          +'         </div> '
			          +'     </div> '
			          +'     <div class="item-info-wrap"> '
			          +'         <div class="item-info"> '
			          +'             <p class="item-info-tit"> '
			          +'                 <span class="vip-name">'+data[j].name+'</span> '
			          +'                 <i class="flag-zx" title="珍心会员"></i> '
			          +'                 <i class="flag-star"></i> '
			          +'                 <i class="ico_money" title="高收入"></i> '
			          +'                 <i class="ico_house" title="有房"></i> '
			          +'                 <span class="vip-dely">在线</span> '
			          +'             </p> '
			          +'             <p class="item-info-area"> '
			          +data[j].area
			          +'             </p> '
			          +'         </div> '
			          +'         <div class="item-info-bottom"> '
			          +'             <b>内心独白：</b> '
			          +'             <span> '
			    	  +data[j].info
			          +'         	 </span> '
			          +'         </div> '
			          +'     </div> '
			          +' </a> ';
	          var div = document.createElement("div");
	          div.className = 'ph-item';
	          div.innerHTML = eleText;
	          waterfullCon.appendChild(div);
	          waterloading.style.display = 'block';

	          document.getElementById('img'+j).onload = function(e){
				e.stopPropagation();
				 waterloading.style.display = 'none';
				  setWaterfull();
				}




				}
				pageSize++;
			}else{
				waterfullEnd.style.display = 'block';
				waterfullCon.style.height = boxes[boxes.length - 1].offsetTop+boxes[boxes.length - 1].offsetHeight+25+'px';
			}
		}
	}
	var btn = document.getElementById("ct_button");
	btn.onclick = fn1();
	$(".search_short_l>ul>li").mouseenter(function() {
		//当前的li，设置active，其他的去除active;
		$(this).addClass("active").siblings("li").removeClass("active");
		//对应索引值的div添加selected，其他的去除selected；
		$(".container").eq($(this).index()).addClass("selected").show().siblings("div").removeClass("selected").hide();
		fn1();
	});
	function fn1 () {
		if(pageSize<dataArr.length){
			var data = dataArr[pageSize];
			for(var j =0; j<data.length; j++){
				var eleText =  ' <a href="javascript:;"> '
					+'     <div class="item-img"><img src="images/'+data[j].img+'"id=img'+j+'> '
					+'         <div class="how"> '
					+'             <i></i> 打招呼 '
					+'         </div> '
					+'     </div> '
					+'     <div class="item-info-wrap"> '
					+'         <div class="item-info"> '
					+'             <p class="item-info-tit"> '
					+'                 <span class="vip-name">'+data[j].name+'</span> '
					+'                 <i class="flag-zx" title="珍心会员"></i> '
					+'                 <i class="flag-star"></i> '
					+'                 <i class="ico_money" title="高收入"></i> '
					+'                 <i class="ico_house" title="有房"></i> '
					+'                 <span class="vip-dely">在线</span> '
					+'             </p> '
					+'             <p class="item-info-area"> '
					+data[j].area
					+'             </p> '
					+'         </div> '
					+'         <div class="item-info-bottom"> '
					+'             <b>内心独白：</b> '
					+'             <span> '
					+data[j].info
					+'         	 </span> '
					+'         </div> '
					+'     </div> '
					+' </a> ';
				var div = document.createElement("div");
				div.className = 'ph-item';
				div.innerHTML = eleText;
				waterfullCon.appendChild(div);
				waterloading.style.display = 'block';

				document.getElementById('img'+j).onload = function(e){
					e.stopPropagation();
					waterloading.style.display = 'none';
					setWaterfull();
				}
			}
			pageSize++;
		}else{
			waterfullEnd.style.display = 'block';
			waterfullCon.style.height = boxes[boxes.length - 1].offsetTop+boxes[boxes.length - 1].offsetHeight+25+'px';
		}
	};
	function setWaterfull(){
			for(var i =0; i<boxes.length; i++){
					boxes[i].style.position = 'absolute';

				if(i<5){
					boxes[i].style.left = (i*(boxW+20))+'px';
					boxes[i].style.top = '0px';
					hArr[i] =  boxes[i].offsetHeight+18;
				}else{
					 var minHeight = getMin(hArr).value;//最小的高度
		             var minHeightIndex = getMin(hArr).index;//	
		             boxes[i].style.top = minHeight + "px";
		              boxes[i].style.left = boxes[minHeightIndex].style.left;
		              //更新数组里面的数据
		              hArr[minHeightIndex]+=boxes[i].offsetHeight+18
				}
			}
			console.log( );
			waterfullCon.style.height = boxes[boxes.length - 1].offsetTop+boxes[boxes.length - 1].offsetHeight+25+'px';

	}

	 function bottomed() {
            //窗口的高度+页面被卷去的头部 > 最后一个盒子的offsetTop
            //窗口的高度
            var clientHeight = window.innerHeight;
            //页面被卷去的头部
            var scrollTop = window.pageYOffset;
            //最后一个盒子的offsetTop
            var lastBox = boxes[boxes.length - 1];//最后的盒子
            console.log( )
            var lastBoxTop = lastBox.offsetTop;
            //窗口的高度+页面被卷去的头部 > 最后一个盒子的offsetTop+盒子高度的一半
            if (clientHeight + scrollTop > (lastBoxTop+waterfull.offsetTop+lastBox.offsetHeight/2)) {
                return true;//表示触底了
            }
            return false;//没有触底

        }


 function getMin(arr) {
        var min = {};
        min.index = 0;//最小值的索引
        min.value = arr[min.index];//最小值的值
        //遍历数组 一个一个比较
        for (var i = 0; i < arr.length; i++) {
            if (min.value > arr[i]) {
                min.value = arr[i];
                min.index = i;
            }
        }
        return min;
    }
}